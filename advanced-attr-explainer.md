# CSS advanced attr() function

## Authors:

- Munira Tursunova, [@moonira](moonira@google.com)

## Introduction

The augmentation to `attr()` specified in CSS Level 5, which allows types besides `<string>` and usage in all CSS properties (besides pseudo-element `content`).

## Motivating Use Cases

The old `attr()` function had limited functionality, only working within the `content` property of pseudo-elements and only accepting `string` values. However, the advanced `attr()` function now supports a wider range of data types (matching those allowed in [\<syntax>](https://drafts.csswg.org/css-values-5/#css-syntax), and more) and can be used in any CSS property, including both registered and unregistered custom properties.

### Use Cases 1
Simple color example:
```html
<style>
  div {
     background-color: attr(data-foo type(<color>), red);
  }
</style>
<div data-foo="blue">test</div>
```

### Use Cases 2
Dimension units:
```html
<style>
  div {
    font-size: attr(data-foo px);
  }
</style>
<div data-foo="10">test</div>
```

### Use Cases 3
Registered custom properties:
```html
<style>
  @property --prop {
    syntax: "<length> | <percentage>";
    inherits: false;
    initial-value: "10px";
  }
  div {
    font-size: attr(data-foo type(<length> | <percentage>));
  }
</style>
<div data-foo="30%">test</div>
```

## Proposed Syntax

New syntax for CSS attr() function:

```
attr() = attr( <attr-name> <attr-type>? , <declaration-value>?)

<attr-name> = [ <ident-token> '|' ]? <ident-token>
<attr-type> = type( <syntax> ) | string | <attr-unit>
```

See [7.7. Attribute References: the attr() notation of the CSS Values and Units Module Level 5 spec](https://drafts.csswg.org/css-values-5/#attr-notation).

## Considerations for Security and Privacy

As highlighted in [issue #5092](https://github.com/w3c/csswg-drafts/issues/5092), new `attr()` syntax could be exploited to extract sensitive information like passwords.

To mitigate this risk, the concept of "attr()-tainting" was introduced. Values generated by the `attr()` function are marked as "attr()-tainted" and using "attr()-tainted" values as or in a `<url>` makes a declaration invalid at computed-value time (IACVT). For instance following usage of `attr()` will be IACVT:

```css
background-image: image-set(attr(data-foo));
```

While this is still valid:

```css
background-image: url(https://does-not-exist.test/404.png), attr(data-foo type(<image>)); /* where data-foo=linear-gradient(#000000, #ffffff) */
```

**Note**: Using attr() indirectly via a custom property causes attr()-tainting of the whole custom property value, for instance the following case is IACVT:

```css
--prop: url("https://does-not-exist.test/404.png") type(attr(data-foo));
background-image: image-set(var(--prop));
```

See [7.7.2. Security of the CSS Values and Units Module Level 5](https://drafts.csswg.org/css-values-5/#attr-security).

## Backwards compatibility

There are a few known cases when the new advanced `attr()` function behaves differently from the old one that is only supported in pseudo-element content property.

### Example 1

```html
<style>
  div::before { content: attr(text) " World"; }
  div::before { content: attr(text) 1px; }
</style>
<div text="Hello"></div>
```

In the above example, the old `attr()` behavior is to display "Hello World", since the second declaration isn't accepted by the parser. With the new behavior, the second declaration is accepted by the parser, but becomes IACVT, see [@andruud comment from Chrome Intent to Implement thread](https://bit.ly/2XDhHtg).

### Example 2

```html
<style>
#parent { --x: attr(data-attr); }
#child::before { content: var(--x); }
</style>
<div id=parent><div id=child data-attr="foo"></div></div>
```

The old `attr()` behavior is to display "foo". The new `attr()` should be similar to var(). First --x is computed on #parent by substituting attr() and is equal to the empty string. Then in #child::before --x is inherited from its parent and return an empty content, see [@xiaochengh comment on the attr() issue discussion](https://bit.ly/3grF3ur).

